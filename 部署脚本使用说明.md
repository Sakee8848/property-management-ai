# 🚀 自动部署脚本使用说明

## 📦 功能特性

这个自动化部署脚本 `deploy.sh` 可以帮你：

✅ **自动提交代码**
- 自动检测文件变更
- 添加所有更改到Git
- 生成规范的提交信息

✅ **自动推送到GitHub**
- 推送main分支
- 更新gh-pages分支
- 自动触发GitHub Pages部署

✅ **自动生成文档**
- `RELEASE.md` - 版本发布记录
- `DEPLOYMENT_SUMMARY.txt` - 部署摘要

✅ **自动版本管理**
- 基于提交次数自动生成版本号
- 格式：v1.0.0, v1.0.1, v1.1.0...

✅ **变更统计**
- 显示修改的文件列表
- 统计新增/删除的代码行数
- 记录提交者和时间

---

## 🎯 使用方法

### 方式1：带变更说明（推荐）

```bash
./deploy.sh "修复登录页面样式问题"
```

```bash
./deploy.sh "新增AI对话历史记录功能"
```

```bash
./deploy.sh "优化移动端响应式布局"
```

### 方式2：交互式输入

```bash
./deploy.sh
```

脚本会提示你输入变更说明。

### 方式3：使用默认说明

```bash
./deploy.sh ""
```

将使用默认说明："更新和优化系统功能"

---

## 📋 完整流程示例

### 场景：修改了前端代码，需要部署

```bash
# 1. 修改代码
vim frontend/src/views/Login.vue

# 2. 运行部署脚本
./deploy.sh "修复登录页面按钮样式"

# 3. 脚本自动执行：
#    - 检测到文件变更
#    - 生成版本号（如：v1.0.6）
#    - 提交代码
#    - 生成RELEASE.md
#    - 生成DEPLOYMENT_SUMMARY.txt
#    - 推送到GitHub
#    - 显示访问地址

# 4. 等待30秒，访问URL查看效果
open https://sakee8848.github.io/property-management-ai/mvp-prototype.html
```

---

## 📂 生成的文档

### RELEASE.md - 版本发布记录

记录所有版本的变更历史：

```markdown
## v1.0.6 - 2026-01-17 15:30:25

### 🎯 本次变更
修复登录页面按钮样式

### 📊 统计信息
- 变更统计：15 additions, 3 deletions
- 提交时间：2026-01-17 15:30:25
- 提交者：tonyyu

### 📝 变更文件
frontend/src/views/Login.vue
frontend/src/App.vue

### 🔗 访问地址
- MVP演示：https://sakee8848.github.io/property-management-ai/mvp-prototype.html
- GitHub仓库：https://github.com/Sakee8848/property-management-ai
```

### DEPLOYMENT_SUMMARY.txt - 本次部署摘要

快速查看本次部署信息，并包含分享给客户的文案：

```
╔══════════════════════════════════════════════════════════════════╗
║                     部署摘要                                      ║
╚══════════════════════════════════════════════════════════════════╝

版本号：v1.0.6
部署时间：2026-01-17 15:30:25
变更说明：修复登录页面按钮样式

部署状态：✅ 成功

分享给客户：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
您好！物业管理AI系统已更新 🎉

🆕 本次更新：修复登录页面按钮样式

🔗 访问地址：
https://sakee8848.github.io/property-management-ai/mvp-prototype.html
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 🎨 脚本输出示例

运行脚本时会看到：

```
╔══════════════════════════════════════════════════════════════════╗
║                                                                  ║
║              物业管理AI系统 - 自动部署工具                       ║
║                                                                  ║
╚══════════════════════════════════════════════════════════════════╝

ℹ️  检查Git仓库...
✅ Git仓库检查通过
ℹ️  检查代码更改...

ℹ️  检测到以下文件变更：
frontend/src/views/Login.vue
frontend/src/App.vue

ℹ️  变更说明：修复登录页面按钮样式
ℹ️  当前版本：v1.0.6
ℹ️  添加文件到暂存区...
✅ 文件已添加
ℹ️  代码统计：15 additions, 3 deletions
ℹ️  生成Release文档...
✅ Release文档已更新：RELEASE.md
ℹ️  生成部署摘要...
✅ 部署摘要已生成：DEPLOYMENT_SUMMARY.txt
ℹ️  提交更改到本地仓库...
✅ 代码已提交
ℹ️  推送到GitHub...
✅ main分支推送成功
ℹ️  更新gh-pages分支...

╔══════════════════════════════════════════════════════════════════╗
║                                                                  ║
║                    🎉 部署成功！                                  ║
║                                                                  ║
╚══════════════════════════════════════════════════════════════════╝

✅ 版本：v1.0.6
✅ 变更：修复登录页面按钮样式
✅ 时间：2026-01-17 15:30:25

ℹ️  访问地址：
  📱 https://sakee8848.github.io/property-management-ai/mvp-prototype.html

ℹ️  查看详情：
  📄 cat RELEASE.md
  📄 cat DEPLOYMENT_SUMMARY.txt
```

---

## 💡 使用技巧

### 1. 快速部署

创建别名，更简单：

```bash
# 添加到 ~/.zshrc 或 ~/.bashrc
alias deploy='cd /Users/tonyyu/Documents/物业管理 && ./deploy.sh'

# 然后可以在任何地方运行
deploy "修复bug"
```

### 2. 查看发布历史

```bash
# 查看所有版本记录
cat RELEASE.md

# 查看最近5个版本
head -n 100 RELEASE.md

# 查看本次部署摘要
cat DEPLOYMENT_SUMMARY.txt
```

### 3. 快速分享

```bash
# 复制部署摘要到剪贴板（Mac）
cat DEPLOYMENT_SUMMARY.txt | pbcopy

# 然后直接粘贴发给客户
```

### 4. 检查部署状态

```bash
# 查看Git状态
git status

# 查看最近提交
git log --oneline -5

# 查看远程仓库
git remote -v
```

---

## 🔧 高级配置

### 自定义版本号规则

编辑 `deploy.sh` 中的 `get_version()` 函数：

```bash
get_version() {
    local commit_count=$(git rev-list --count HEAD 2>/dev/null || echo "0")
    local major=1
    local minor=$((commit_count / 10))
    local patch=$((commit_count % 10))
    echo "v${major}.${minor}.${patch}"
}
```

### 自定义提交信息格式

编辑 `deploy.sh` 中的第9步：

```bash
local full_commit_msg="[$version] $commit_message"
# 可以改为：
# local full_commit_msg="feat: $commit_message"
# local full_commit_msg="🚀 $commit_message"
```

---

## 📊 版本号说明

版本号格式：`v主版本.次版本.修订号`

- **主版本**：固定为1
- **次版本**：每10次提交增加1
- **修订号**：0-9循环

示例：
- 第1次提交：v1.0.1
- 第5次提交：v1.0.5
- 第10次提交：v1.1.0
- 第15次提交：v1.1.5
- 第20次提交：v1.2.0

---

## ⚠️ 注意事项

### 1. 首次使用

确保已经推送过代码到GitHub：

```bash
# 如果还没有推送，先运行：
git remote add origin https://github.com/Sakee8848/property-management-ai.git
git push -u origin main
```

### 2. 权限问题

如果提示权限不足：

```bash
chmod +x deploy.sh
```

### 3. 网络问题

如果推送失败，检查：
- GitHub是否能访问
- 是否已登录GitHub
- 网络连接是否正常

### 4. 冲突解决

如果出现推送冲突：

```bash
# 拉取最新代码
git pull origin main

# 解决冲突后重新运行
./deploy.sh "解决冲突"
```

---

## 🎯 常见场景

### 场景1：日常开发更新

```bash
# 修改了代码
vim frontend/src/views/Chat.vue

# 一键部署
./deploy.sh "优化AI对话界面"

# 完成！
```

### 场景2：修复紧急Bug

```bash
# 修复bug
vim frontend/src/utils/axios.js

# 快速部署
./deploy.sh "紧急修复：API请求超时问题"

# 通知客户
cat DEPLOYMENT_SUMMARY.txt | pbcopy
# 粘贴发送
```

### 场景3：批量更新文档

```bash
# 更新多个文档
vim README.md
vim QUICKSTART.md
vim 如何启动.md

# 一次性提交
./deploy.sh "更新项目文档"
```

### 场景4：版本发布

```bash
# 完成新功能开发
./deploy.sh "v2.0新功能：添加支付宝支付集成"

# 查看发布记录
cat RELEASE.md

# 分享给团队
```

---

## 📚 相关命令

```bash
# 查看帮助（脚本内置）
./deploy.sh --help

# 查看版本历史
git log --oneline --all

# 查看当前版本
./deploy.sh --version

# 撤销上次提交（不推荐）
git reset --soft HEAD~1

# 查看远程仓库状态
git remote show origin

# 强制推送（危险，不推荐）
git push -f origin main
```

---

## 🎉 最佳实践

### 1. 清晰的提交信息

✅ 好的示例：
```bash
./deploy.sh "修复登录页面样式错位问题"
./deploy.sh "新增用户头像上传功能"
./deploy.sh "优化移动端触摸响应速度"
./deploy.sh "更新API文档和使用说明"
```

❌ 不好的示例：
```bash
./deploy.sh "修改"
./deploy.sh "update"
./deploy.sh "..."
```

### 2. 定期部署

建议：
- 每天工作结束前部署一次
- 完成重要功能后立即部署
- 修复bug后马上部署

### 3. 保持文档更新

自动生成的 `RELEASE.md` 会保留所有历史，定期查看：

```bash
# 查看最近10个版本
head -n 200 RELEASE.md

# 搜索特定功能
grep "登录" RELEASE.md
```

---

## 🚀 快速开始

立即尝试：

```bash
# 1. 进入项目目录
cd /Users/tonyyu/Documents/物业管理

# 2. 运行部署脚本
./deploy.sh "测试自动部署脚本"

# 3. 查看结果
cat DEPLOYMENT_SUMMARY.txt

# 4. 访问URL
open https://sakee8848.github.io/property-management-ai/mvp-prototype.html
```

---

**享受自动化部署的便捷吧！** 🎊
